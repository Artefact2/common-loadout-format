#!/usr/bin/env php
<?php
/* Author : Romain "Artefact2" Dalmaso <artefact2@gmail.com>
 * This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar. See
 * http://sam.zoy.org/wtfpl/COPYING for more details. */

/* Create a JSON map (typenames => typeids) from the supplied SQLite
 * SDEs.
 *
 * The SDEs will be processed in the order they are supplied,
 * overwriting any previous typename => typeid associations.
 *
 * Also works for SQLite databases generated by the Eos dumper.
 */

require __DIR__.'/sqlite_script_common.php';

function process($db, &$typenames) {
	$req = $db->query('SELECT typename, typeid FROM invtypes');

	while($row = $req->fetchArray(SQLITE3_NUM)) {
		list($typename, $typeid) = $row;
		$typenames[$typename] = $typeid;
	}
}

function customsort(&$typenames) {
	uksort($typenames, function($p, $q) use($typenames) {
			if($typenames[$p] == $typenames[$q]) {
				/* Same typeID, sort by key name */
				return strcmp($p, $q);
			} else {
				/* Different typeIDs, sort by typeID */
				return $typenames[$p] - $typenames[$q];
			}
		});
}
